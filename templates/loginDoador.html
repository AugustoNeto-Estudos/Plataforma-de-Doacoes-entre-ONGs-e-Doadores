<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>SolidariHub - Login/Cadastro</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styleLoginDoador.css') }}">
</head>
<body>
  <div class="container">
    <!-- LOGIN -->
    <div class="form-section" id="login-form-section">
      <div class="logo">
        <img src="{{ url_for('static', filename='img/SolidariHub_logo_escrito_azul.png') }}" alt="SolidariHub" class="logo-img">
      </div>
      <h2>Login de Doadores</h2>

      <!-- Mensagens de erro ou sucesso -->
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <ul class="flash-messages">
            {% for msg in messages %}
              <li>{{ msg }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endwith %}

      <!-- Formulário de login -->
      <form method="POST" action="/LoginDoador">
        <input type="email" name="email" placeholder="Email" required>
        <div class="password-container">
          <input type="password" name="senha" placeholder="Senha" id="login-senha" required>
          <img src="{{ url_for('static', filename='img/icone-oculte.png') }}" alt="Mostrar/ocultar senha" class="toggle-password" data-target="login-senha">
        </div>
        <button type="submit" class="btn">Entrar</button>
      </form>

      <a href="{{ url_for('recuperar_senha.recuperar_senha') }}" class="link">Esqueceu sua senha?</a>
      <hr>
      <p>Ainda não tem conta?</p>
      <a href="#" onclick="mostrarCadastro()" class="btn-secondary">Cadastre-se como Doador</a>
    </div>

    <div class="image-section" id="image-login"></div>

    <!-- CADASTRO -->
    <div class="image-section" id="image-cadastro" style="display:none;"></div>
    <div class="form-section" id="cadastro-form-section" style="display:none;">
      <div class="logo">
        <img src="{{ url_for('static', filename='img/SolidariHub_logo_escrito_azul.png') }}" alt="SolidariHub" class="logo-img">
      </div>
      <h2>Cadastro de Doadores</h2>

      <!-- Mensagens de erro ou sucesso -->
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <ul class="flash-messages">
            {% for msg in messages %}
              <li>{{ msg }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endwith %}

      <!-- Formulário de cadastro -->
      <form method="POST" action="/CadastroDoador">
        <input type="text" name="cpf" placeholder="CPF Exemplo: 000.000.000-00" pattern="\d{3}\.\d{3}\.\d{3}-\d{2}" value="{{ request.form.get('cpf', '') }}" required>
        <input type="text" name="nome" placeholder="Nome" value="{{ request.form.get('nome', '') }}" required>
        <input type="email" name="email" placeholder="Email" value="{{ request.form.get('email', '') }}" required>
        <input type="tel" name="contato" placeholder="Contato (DDD+Número)" value="{{ request.form.get('contato', '') }}">

        <div class="password-container">
          <input type="password" name="senha" placeholder="Senha" id="cadastro-senha" required>
          <img src="{{ url_for('static', filename='img/icone-oculte.png') }}" alt="Mostrar/ocultar senha" class="toggle-password" data-target="cadastro-senha">
        </div>

        <div class="password-container">
          <input type="password" name="confirmar_senha" placeholder="Confirme sua senha" id="cadastro-confirmar" required>
          <img src="{{ url_for('static', filename='img/icone-oculte.png') }}" alt="Mostrar/ocultar senha" class="toggle-password" data-target="cadastro-confirmar">
        </div>
        <button type="submit" class="btn">Cadastrar</button>
      </form>

      <hr>
      <p>Já tem conta?</p>
      <a href="#" onclick="mostrarLogin()" class="btn-secondary">Voltar para Login</a>
    </div>
  </div>

  <!-- MODAL DE CONSENTIMENTO -->
  <div id="modal-termos" class="modal-overlay" style="display:none;">
    <div class="modal-content">
      <button id="fechar-modal" class="fechar-modal">✖</button>
      <h3>Antes de continuar…</h3>
      <p>Ao cadastrar-se no SolidariHub, você confirma que leu e concorda com nossos 
        <a href="/termos" target="_blank">Termos de Uso</a> e 
        <a href="/termos#privacidade" target="_blank">Política de Privacidade</a>.
      </p>
      <label>
        <input type="checkbox" id="aceite-termos"> Eu aceito os termos e políticas
      </label>
      <br>
      <button id="btn-continuar" class="btn-continuar" disabled>Continuar para Cadastro</button>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    function mostrarCadastro() {
      document.getElementById("modal-termos").style.display = "flex";
    }

    function mostrarCadastroDireto() {
      // Exibe diretamente o formulário de cadastro sem passar pelo modal
      document.getElementById("modal-termos").style.display = "none";
      document.getElementById("login-form-section").style.display = "none";
      document.getElementById("image-login").style.display = "none";
      document.getElementById("cadastro-form-section").style.display = "flex";
      document.getElementById("image-cadastro").style.display = "block";
    }

    function mostrarLogin() {
      document.getElementById("modal-termos").style.display = "none";
      document.getElementById("cadastro-form-section").style.display = "none";
      document.getElementById("image-cadastro").style.display = "none";
      document.getElementById("login-form-section").style.display = "flex";
      document.getElementById("image-login").style.display = "block";
    }

    document.addEventListener("DOMContentLoaded", () => {
      const checkbox = document.getElementById("aceite-termos");
      const btnContinuar = document.getElementById("btn-continuar");
      const btnFechar = document.getElementById("fechar-modal");

      checkbox.addEventListener("change", () => {
        btnContinuar.disabled = !checkbox.checked;
      });

      btnContinuar.addEventListener("click", () => {
        mostrarCadastroDireto();
      });

      btnFechar.addEventListener("click", () => {
        mostrarLogin();
      });

      // Alternância de senha visível/invisível
      document.querySelectorAll(".toggle-password").forEach(icon => {
        icon.addEventListener("click", () => {
          const targetId = icon.getAttribute("data-target");
          const input = document.getElementById(targetId);

          if (input.type === "password") {
            input.type = "text";
            icon.src = "{{ url_for('static', filename='img/icone-olho.png') }}";
          } else {
            input.type = "password";
            icon.src = "{{ url_for('static', filename='img/icone-oculte.png') }}";
          }
        });
      });

      // Imagem aleatória de fundo
      const imagensLogin = [
        "https://images.pexels.com/photos/6995106/pexels-photo-6995106.jpeg",
        "https://images.pexels.com/photos/6647119/pexels-photo-6647119.jpeg",
        "https://images.pexels.com/photos/6646877/pexels-photo-6646877.jpeg",
        "https://images.pexels.com/photos/6646874/pexels-photo-6646874.jpeg"
      ];
      const escolhida = imagensLogin[Math.floor(Math.random() * imagensLogin.length)];
      document.getElementById("image-login").style.backgroundImage = `url('${escolhida}')`;
    });
  </script>

  <!-- Exibe diretamente o cadastro se houver erro -->
  {% if mostrar_cadastro %}
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      mostrarCadastroDireto();
    });
  </script>
  {% endif %}
</body>
</html>
